#!/usr/bin/env ruby
$: << File.expand_path("#{File.dirname(__FILE__)}/../lib")
require 'rubygems'
require 'trollop'
require 'zencoder'
require 'zencoder/cli/command'

COMMANDS = %w(setup setup:delete plugins:list jobs:list)
global_options = Trollop::options do
  version "Zencoder #{Zencoder::GEM_VERSION}"
  banner <<-EOS
--------------------
Zencoder CLI v#{Zencoder::GEM_VERSION}
--------------------

== Usage

zencoder command [options]

== Available Commands

setup                  # Caches authentication credentials
setup:delete           # Removes the cached credentials

plugins:list           # Lists installed plugins

jobs:list              # Lists the most recent jobs

== Options

EOS
  stop_on COMMANDS
end

if ARGV.empty?
  puts "You must specify a command. Use --help for more information."
  exit(1)
end

command = ARGV.shift.strip
args = ARGV

command_banner = <<-EOS
== Usage

zencoder #{command} [options]

== Options
EOS
command_options = case command
  when "jobs"
    Trollop::options do
      banner command_banner
      opt :number, "Number of jobs returned per page. Default 10.", :type => Integer
      opt :page,   "Jobs page number. Default 1.", :type => Integer
    end
  else
    Trollop::options do
      banner command_banner
    end
  end

ZencoderCLI::Command.run(command, args, global_options, command_options)
